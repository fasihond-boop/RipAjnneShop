<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RipAjnne - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background: #0f172a; color: white; }
        .admin-card { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        input { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; outline: none; width: 100%; margin-bottom: 10px; color: white; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-red-500">ADMIN CONTROL PANEL</h1>

        <div class="admin-card mb-8">
            <h2 class="text-xl mb-4 text-blue-400">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Topup)</h2>
            <div class="flex gap-2">
                <input type="email" id="targetEmail" placeholder="‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô">
                <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="w-32">
            </div>
            <button onclick="updateBalance()" class="bg-blue-600 px-6 py-2 rounded-lg font-bold w-full hover:bg-blue-700">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>

        <div class="admin-card mb-8">
            <h2 class="text-xl mb-4 text-green-400">üì¶ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Store)</h2>
            <input type="text" id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
            <input type="number" id="pPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
            <input type="text" id="pImg" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)">
            <input type="text" id="pUser" placeholder="Username (‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)">
            <input type="text" id="pPass" placeholder="Password (‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)">
            <button onclick="addProduct()" class="bg-green-600 px-6 py-2 rounded-lg font-bold w-full hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        </div>

        <div class="admin-card">
            <h2 class="text-xl mb-4">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <div id="adminProductList" class="space-y-2">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, setDoc, addDoc, collection, onSnapshot, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üõë ‡∏ß‡∏≤‡∏á Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ üõë
        const firebaseConfig = {
            apiKey: "AIzaSyAfML9ajHOufn3MDLSBZlXvaKl5YOobTpE",
            authDomain: "ripajnne-shop.firebaseapp.com",
            projectId: "ripajnne-shop",
            storageBucket: "ripajnne-shop.firebasestorage.app",
            messagingSenderId: "1046234530869",
            appId: "1:1046234530869:web:2af4b0bcc8f4a73a3e5d7c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
        window.updateBalance = async () => {
            const email = document.getElementById('targetEmail').value;
            const cash = Number(document.getElementById('amount').value);
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ User ‡∏à‡∏≤‡∏Å Email
            const q = query(collection(db, "users"), where("email", "==", email));
            const querySnapshot = await getDocs(q);
            
            if (!querySnapshot.empty) {
                const userDoc = querySnapshot.docs[0];
                await updateDoc(doc(db, "users", userDoc.id), { balance: cash });
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ " + email + " ‡πÄ‡∏õ‡πá‡∏ô " + cash + " ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } else {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        window.addProduct = async () => {
            const data = {
                name: document.getElementById('pName').value,
                price: Number(document.getElementById('pPrice').value),
                img: document.getElementById('pImg').value,
                id_user: document.getElementById('pUser').value,
                id_pass: document.getElementById('pPass').value
            };
            await addDoc(collection(db, "products"), data);
            alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            location.reload();
        };

        // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏•‡∏ö
        onSnapshot(collection(db, "products"), (snap) => {
            let html = '';
            snap.forEach(docSnap => {
                const p = docSnap.data();
                html += `
                    <div class="flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                        <span>${p.name} - ${p.price}‡∏ø</span>
                        <button onclick="deleteProduct('${docSnap.id}')" class="text-red-500 font-bold">‡∏•‡∏ö</button>
                    </div>
                `;
            });
            document.getElementById('adminProductList').innerHTML = html;
        });

        window.deleteProduct = async (id) => {
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∞‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ?')) {
                await deleteDoc(doc(db, "products", id));
            }
        };
    </script>
</body>
</html>
