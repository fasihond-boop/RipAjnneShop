<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RipAjnne - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background: #0f172a; color: white; }
        .admin-card { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        input, textarea { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; outline: none; width: 100%; margin-bottom: 10px; color: white; }
        textarea { min-height: 80px; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-red-500 italic uppercase">ADMIN CONTROL PANEL</h1>

        <div class="admin-card mb-8">
            <h2 class="text-xl mb-4 text-blue-400">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Topup)</h2>
            <div class="flex gap-2">
                <input type="email" id="targetEmail" placeholder="‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô">
                <input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="w-32">
            </div>
            <button onclick="updateBalance()" class="bg-blue-600 px-6 py-2 rounded-lg font-bold w-full hover:bg-blue-700 transition">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="admin-card">
                <h2 class="text-xl mb-4 text-green-400">üì¶ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Store)</h2>
                <input type="text" id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                <input type="number" id="pPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
                <input type="text" id="pImg" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)">
                <input type="text" id="pUser" placeholder="Username (‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)">
                <input type="text" id="pPass" placeholder="Password (‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)">
                <button onclick="addProduct()" class="bg-green-600 px-6 py-2 rounded-lg font-bold w-full hover:bg-green-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            </div>

            <div class="admin-card">
                <h2 class="text-xl mb-4 text-red-400">üé∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡πà‡∏° (Gacha)</h2>
                <input type="text" id="gName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏π‡πâ‡∏™‡∏∏‡πà‡∏°">
                <input type="number" id="gPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°">
                <input type="text" id="gImg" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏π‡πâ (URL)">
                <textarea id="gPool" placeholder="‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö User:Pass , ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥) ‡πÄ‡∏ä‡πà‡∏ô id1:pass1, id2:pass2"></textarea>
                <button onclick="addGacha()" class="bg-red-600 px-6 py-2 rounded-lg font-bold w-full hover:bg-red-700 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏π‡πâ‡∏™‡∏∏‡πà‡∏°</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="admin-card">
                <h2 class="text-xl mb-4 text-gray-300">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <div id="adminProductList" class="space-y-2"></div>
            </div>
            <div class="admin-card">
                <h2 class="text-xl mb-4 text-gray-300">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏π‡πâ‡∏™‡∏∏‡πà‡∏°</h2>
                <div id="adminGachaList" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, updateDoc, addDoc, collection, onSnapshot, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAfML9ajHOufn3MDLSBZlXvaKl5YOobTpE",
            authDomain: "ripajnne-shop.firebaseapp.com",
            projectId: "ripajnne-shop",
            storageBucket: "ripajnne-shop.firebasestorage.app",
            messagingSenderId: "1046234530869",
            appId: "1:1046234530869:web:2af4b0bcc8f4a73a3e5d7c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ---
        window.updateBalance = async () => {
            const email = document.getElementById('targetEmail').value;
            const cash = Number(document.getElementById('amount').value);
            const q = query(collection(db, "users"), where("email", "==", email));
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) {
                await updateDoc(doc(db, "users", querySnapshot.docs[0].id), { balance: cash });
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ " + email + " ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            } else { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ"); }
        };

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Store ---
        window.addProduct = async () => {
            await addDoc(collection(db, "products"), {
                name: document.getElementById('pName').value,
                price: Number(document.getElementById('pPrice').value),
                img: document.getElementById('pImg').value,
                id_user: document.getElementById('pUser').value,
                id_pass: document.getElementById('pPass').value
            });
            alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            location.reload();
        };

        // --- ‡∏£‡∏∞‡∏ö‡∏ö Gacha ---
        window.addGacha = async () => {
            const rawPool = document.getElementById('gPool').value; // id1:pass1, id2:pass2
            const itemsArray = rawPool.split(',').map(item => {
                const [u, p] = item.trim().split(':');
                return { id_user: u || 'N/A', id_pass: p || 'N/A' };
            });

            await addDoc(collection(db, "gacha"), {
                name: document.getElementById('gName').value,
                price: Number(document.getElementById('gPrice').value),
                img: document.getElementById('gImg').value,
                items: itemsArray // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô Array ‡∏Ç‡∏≠‡∏á User/Pass
            });
            alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏π‡πâ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            location.reload();
        };

        // --- ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡∏•‡∏ö) ---
        onSnapshot(collection(db, "products"), (snap) => {
            let html = '';
            snap.forEach(docSnap => {
                html += `<div class="flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                    <span class="text-sm">${docSnap.data().name} (${docSnap.data().price}‡∏ø)</span>
                    <button onclick="deleteDocItem('products','${docSnap.id}')" class="text-red-500 font-bold">‡∏•‡∏ö</button>
                </div>`;
            });
            document.getElementById('adminProductList').innerHTML = html;
        });

        onSnapshot(collection(db, "gacha"), (snap) => {
            let html = '';
            snap.forEach(docSnap => {
                html += `<div class="flex justify-between items-center bg-black/30 p-3 rounded-lg border border-white/5">
                    <span class="text-sm text-red-400">${docSnap.data().name} (${docSnap.data().price}‡∏ø)</span>
                    <button onclick="deleteDocItem('gacha','${docSnap.id}')" class="text-red-500 font-bold">‡∏•‡∏ö</button>
                </div>`;
            });
            document.getElementById('adminGachaList').innerHTML = html;
        });

        window.deleteDocItem = async (coll, id) => {
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) await deleteDoc(doc(db, coll, id));
        };
    </script>
</body>
</html>
